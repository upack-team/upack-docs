---
sidebar_position: 3
---

# 批准过程

相比工作流规则，批准过程在自动化处理方面更进一步，让您可以指定批准该类记录所必需经历的审批步骤序列。还可以指定在各个时间点、各个审批步骤的自动处理操作。

## 什么是批准过程？

批准过程的处理逻辑如下图所示：

以付款为例，处理过程可能包括：

* 付款记录提交批准时，记录将被锁定，这时用户无法修改它。同时，应将该付款记录的状态修改为“已提交”。
* 不同情形下，审批的过程可能有所区别。如果付款金额为 500元及以下，则无需审批、直接获准；如果付款金额高于 500元，向部门经理发送批准请求；如果付款金额高于5000元，部门经理批准后，还需向分管副总发送批准请求。
* 如果付款申请得到了所有人的批准，则该付款记录的状态会更改为“已批准”，同时解锁记录。如果付款申请未获批准，则该付款记录的状态会更改为“已拒绝”，同时解锁记录。


### 批准的限制和注意事项

在您通过批准过程自动化某些操作之前，应注意相关限制和注意事项。

因为用户无法了解当他们单击提交待批准时将触发哪个批准过程，用户需要熟悉每个批准过程的条件以及每个批准过程的任务。如果记录不符合输入条件或者他们不是任何批准过程的允许提交者，Steedos会显示出错。


**配置批准时的注意事项**

当创建或编辑批准过程时，谨记批准如何兼容工作流规则等功能。在您开始之前，绘制出您的批准过程步骤。

* 批准条件

在批准条件中，请勿引用如：NOW()等解析随机值的表达式。这样，如果需要重新评估条件，则每次会以相同方式评估记录。

* 批准中的字段更新操作

为批准操作执行的字段更新不会触发工作流规则或者授权过程。

* 预期错误

考虑审查批准错误的内容。这样，您可以预测常见问题和配置您的批准过程，减小错误发生的可能性。


**设置批准人时的注意事项**

当您为特定的批准步骤指定批准人，应谨记一些事情。

（1）具有以下权限的用户可以响应批准请求。

* “修改所有数据”权限
* 对象的“修改所有”权限

（2）确保所分配的批准人有权读取批准请求的记录。例如，不能查看费用记录的用户无法查看费用批准请求。

（3）可让用户手动选择批准人的批准过程也会让用户将自己选为批准人。

（4）你可以在单一步骤中向相同用户多次分配批准请求。但是，系统只向该用户发送一个请求。


**管理批准时的注意事项**

当维护现有批准过程（包括启用或删除它们）时应谨记一些东西。

（1）管理权限 具有其中一些权限的用户被视为批准管理员。

* 指定对象的修改所有对象级别权限
* 修改所有数据用户权限 批准管理员可以：
* 批准或拒绝等待批准的请求，无需作为批准过程的一部分。
* 编辑已锁定以待批准的记录。

（2）启用批准过程

* 批准过程必须至少具有一个步骤，您才能启用它。
* 在您启用批准过程之前，请先测试它。
* 启用批准过程后，您无法添加、删除或更改步骤的顺序或更改拒绝或跳过行为，即便该过程无效。

（3）删除批准过程 删除批准过程之前：

* 确保其已停用。
* 删除与其相关联的等待批准请求。


**相关术语**

与批准过程相关的术语如下，请参考。


* **批准操作** 执行批准过程时系统自动执行的批准操作，例如锁定记录、更新相关字段。
* **批准过程** 批准过程用于配置记录如何在Steedos中批准。批准过程会指定批准的每个步骤，包括请求批准发起对象和过程中每个时间点或环节需要采取的操作。
* **批准通知** 批准通知是应用程序通知，用于通知相关处理人，记录已提交待批准。
* **批准步骤** 批准步骤定了一个特殊的批准过程的所有批准环节。每个步骤会决定哪些记录可以转到该步骤以及分配批准请求的处理人。

  第一步指定如果记录不前进到该步骤时应如何处理。后来的步骤指定如果批准人拒绝该请求会怎样。
* **分配的批准人** 分配的批准人是负责响应某批准请求的用户。
* **重新分配批准人** 重新分配批准人是由分配的批准人重新指定处理批准请求的人员。
* **初始提交操作** 当用户第一次提交记录以待时，发生初始提交操作。默认情况下，记录被锁定。
* **最终批准操作** 在完成所有必需批准时实施最终批准操作。
* **最终拒绝操作** 当批准人拒绝请求并转为最终拒绝状态时发生最终拒绝操作。
* **批准过程实例（申请单）** 批准过程实例代表批准过程的一个实例。每次记录提交待批准时，都会创建一个新的批准过程实例。
* **批准过程实例节点（签核历程）** 批准过程实例节点代表批准过程步骤的一个实例。记录每次在批准过程中输入一个步骤时，系统均会创建过程实例节点。当记录不满足步骤条件时或批准过程实例在未输入步骤的情况下完成，则系统不会创建过程实例节点。
* **调回操作** 当提交的批准请求被调回时，发生调回操作。默认情况下，记录解除锁定。
* **记录锁定** 记录锁定防止用户编辑记录（无论字段级安全或共享设置如何）。默认情况下，Steedos锁定等待批准的记录。只有管理员可以编辑锁定的记录。


## 设置批准过程

如果批准是适合您业务流程的自动化工具，请遵循以下步骤为您的组织创建新的批准。

* 在“设置”-“流程自动化”中选择“批准过程”，点击新建。
* 为批准过程输入API名称和显示名称。
* 选择要应用该批准过程的对象。
* 依次输入序号：当对象上有多个符合条件的批准过程时，只会触发序号最小的批准过程。
* 输入您的指定条目条件：输入评估结果为“真”值的公式。当公式返回“真”值时，会触发该批准过程执行后续设置的操作。
* 设置记录可编辑性属性：
  * **仅管理员可在批准过程中编辑记录**：默认唯一选项。
* 允许提交人取消申请时请勾选按钮。
* 设置批准过程自动操作的锁定记录，以及对应的字段更新，完成后点击保存。
* 新建批准过程成功后，点击显示名称进入详情页，在页面底部向批准过程添加批准步骤。

### 指定条目条件

如果你希望所有记录都通过批准过程，可在指定条目条件中输入1=1。如果只考虑特定记录类型，可输入进入的条件或公式。当提交的记录满足条件或公式，则可进入该批准过程。

**示例**

只有折扣批准截止日期小于 30 天时，该公式才允许记录进入该批准过程。

```javascript
(discount_approvalDate < (closeDate - 30)
```

只有审批状态instance_state为草稿、拒绝或取消时，当前记录才会出现“提请批准”的按钮。

```javascript
ISPICKVAL(instance_state, 'draft') || ISPICKVAL(instance_state, 'rejected') || ISPICKVAL(instance_state, 'terminated') 
```


### 编辑锁定的记录

记录提交等待批准时，它将被锁定，以防止用户在批准过程中编辑该记录。只有管理员可以编辑在该批准过程中被锁定的记录。

### 批准过程的自动操作

当发生操作时，每个批准过程都会组织到操作组中，例如初始提交。若要将自动操作添加到批准过程，确定要将其添加到哪个操作组中。


1. **初始提交** 用户第一次提交记录以待批准。默认操作：记录锁(锁定)
2. **批准步骤批准** 已针对记录提供该步骤的所有必要批准。默认操作：无
3. **批准步骤拒绝** 批准人拒绝该步骤的请求。默认操作：无
4. **最终批准** 已针对记录提供所有必要批准。默认操作：记录锁(锁定)
5. **最终拒绝** 批准人拒绝该请求，它转至最终拒绝状态。默认操作：记录锁(解锁)
6. **调回** 调回提交的批准请求。默认操作：记录锁(解锁）

## 添加批准步骤

**控制批准步骤**

通过设置步骤标准控制哪些记录作为批准步骤的一部分。您还可以指定不符合步骤标准时如何处理记录。

### 标准选项

如果所有记录都通过该批准步骤，选择 所有记录均应进入此步骤。

如果仅特定类型的记录应进入此过程，请选择如果满足以下条件，则进入此步骤...，然后输入需满足的条件。

如果不满足条件，则：

* 批准记录：批准请求，执行所有最终批准操作。
* 拒绝记录：拒绝请求，执行所有最终拒绝操作。
* 转到下一步： 跳过此步骤并转到下一步。只有当这是以后的步骤时可用。

当您在第一步应用该选项时，谨记：

* 如果记录不符合任何随后步骤的标准，记录会被拒绝。
* 如果您删除以后的所有步骤，Steedos会拒绝该记录。 当您在其他步骤中应用该选项时，谨记：
* 如果您删除以后的所有步骤，Steedos会结束该过程。


### 分配批准人

指定在该步骤中将批准请求发送给谁。


### 序号

当同时有多个符合条件的批准步骤时，只会触发序号最小的批准步骤。

### 选择分配的批准人

指定将批准分配给谁。

* 允许提交人手动选择批准人（默认值)：提示用户选择下一个批准人。
* 自动分配至批准人： 分配批准请求到指定用户、指定审批角色、指定审批岗位、指定相关用户字段处理。

### 选择多个批准人

只有当选中自动分配至批准人时可用。

* 基于首次回复的批准或拒绝：

批准请求的第一个响应决定批准记录还是拒绝记录。

* 要求所有选定批准人的一致批准：

只有在每个人都选择批准时记录才被批准。如果任何批准人拒绝请求，批准请求都会被拒绝。

* 重新分配的批准人也可批准该请求：

批准人重新分配的批准人不能再次分配批准请求；他们只能批准或拒绝它们。


### 指定拒绝行为

配置批准人拒绝请求后的结果。

* 执行所有拒绝操作：即使已经批准之前的步骤，仍然能拒绝请求。执行此步骤中指定的所有拒绝操作以及所有最终拒绝操作。

* 仅执行此步骤的拒绝操作：拒绝请求，将批准请求返回前一个批准人。执行为此步骤指定的所有拒绝操作。


###*选择自动批准人

通过以下选项之一设置下个批准人。

* 提交人手动指定用户来批准所有批准请求。

自动分配至批准人：

* 指定用户处理
* 指定审批角色
* 指定审批岗位
* 指定相关用户字段

## 启用批准过程

在为批准过程创建至少一个步骤后，启用该过程。


1. 进入批准流程，选择需启用的批准过程。
2. 确保配置正确。
3. 点击最右边的倒三角框，选择启用。


## 使用批准过程

您的管理员可以设置批准过程，可让您和其他用户提交记录进行批准，从而产生批准请求。


### 提交记录以待批准

对记录具有读取权限，您可以直接从记录中提交记录以待批准。

* **转至您希望提交以待批准的记录。**
* **确保准备提交。** 在提交待批准记录之前，记录必须满足活动批准过程的条件。如果您不确定要求满足哪些条件，请咨询您的管理员。
* **提交批准。** 如果批准过程适用于记录，会自动开始批准过程。该按钮在提交记录后不可用。


### 撤销批准请求

如果您提交了记录以待批准，但是突然需要更新记录中的信息，可以调回批准请求。然而，您能否调回批准请求取决于您的管理员如何配置批准过程来处理提交的记录。 撤销批准请求所需用户权限需对记录具有读取权限。

* 转至与批准请求有关的记录的详细页面。
* 在批准历史相关列表中，调回批准请求。


### 回应批准请求

您收到批准请求时，通过批准、拒绝或重新分配进行回应。

## 批准历史

若要跟踪批准流程中的记录，查看其批准历史相关列表。

* 已提交：记录已提交待批准。
* 待处理：记录已提交待批准，正在等待批准或拒绝。
* 已批准：记录已批准。
* 已拒绝：记录已被拒绝。
* 已重新分配：记录已提交待批准，但被分配至其他批准人。
* 已调回：提交记录用于批准，但是从批准过程调回。
