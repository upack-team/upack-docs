---
sidebar_position: 2
---

# 工作流规则

 工作流规则可让您自动化标准内部过程和进程，以在贵组织范围内节省时间。工作流规则是一组工作流指示的主要容器。这些指示始终可以用“如果/则”语句概括。

## 什么是工作流规则？

例如：如果下雨，请带雨伞。

工作流规则可以分为两个主要组成部分。

* 条件：“如果/则”语句的“如果”部分。换言之，记录内容必须为真，才能让工作流规则执行关联操作。
* 操作：“如果/则”语句的“则”部分。换言之，在记录满足条件时执行的操作。

在下雨示例中，条件是“如果下雨”，则操作是“带雨伞”。如果条件未满足（未下雨），则不会执行操作（无需带雨伞）。

在记录满足工作流规则的所有条件时，则将会执行规则的操作，请参考[执行自动操作](automated-actions)来了解Steedos目前支持的操作。

### 注意事项

* 每个工作流规则适用于单个对象。
* 删除自定义对象时，将同时删除自定义对象上的工作流规则（暂时未实现）。
* 并不保证单个操作和操作类型执行的顺序。首先，执行字段更新操作，然后是其他操作。
* 在新建或编辑对象时，会先执行该对象的验证规则，再执行该对象的工作流规则，但是就目前来说，工作流规则中的操作，比如字段更新并不会再次触发验证规则。

### 何时触发？

* 保存记录或创建记录时都可以触发工作流规则，这取决于您的规则条件。在保存记录后创建的规则不会追溯地影响这些记录。
* 修改或创建记录可能会触发多个规则。
* 工作流规则自动触发且用户不可见。

### 相关术语

当描述工作流特性和功能时，使用了以下术语。

- **工作流规则** 满足其指定的条件时，工作流规则将使工作流开始操作。您可以配置工作流操作，使其在某记录符合工作流规则中的条件时立即执行，或设置时间触发器，使其在特定日执行工作流操作。
- **工作流操作** 工作流操作是在满足工作流规则条件时触发的相关操作，Steedos暂时只支持字段更新这一种操作，未来可能会扩展更多操作类型，比如发送出站消息或电子邮件等。
- **字段更新** 字段更新是使用新值自动更新字段的操作。
- **出站消息** 出站消息会将信息发送到指定端点，例如外部服务。


## 创建工作流规则

通过创建工作流规则可使贵组织的标准过程实现自动化，可选择规则涉及的对象并配置其条件来开始创建一个新的工作流规则。

* 在“设置”-“流程自动化”中选择“工作流规则”，点击新建。
* 选择要应用该工作流规则的对象。
* 为工作流规则输入API名称和显示名称。
* 需要启用该规则请勾选启用按钮。
* 设置评估条件：
  * **新建时**：在每次创建记录时评估规则条件。如果满足规则条件，运行规则。忽略现有记录的所有更新。使用此选项时，规则对每个记录的运行次数从不超过一次。
  * **新建时，和每次编辑时**：在每次创建或更新记录时评估规则条件。如果满足规则条件，运行规则。使用此选项时，只要记录满足规则条件，每次编辑记录时，规则都会重复运行。（如果您选择此选项，则无法添加依赖于时间的操作）
  * **新建时，或编辑数据导致条件成立：**（默认）在每次创建或更新记录时评估规则条件。对于新记录，在满足规则条件的情况下运行规则。对于更新的记录，仅在将记录从未满足规则条件到更改为满足规则条件的情况下执行规则。使用此选项时，规则对每个记录可以运行多次，但是，如果记录编辑与规则条件无关，则规则不运行。

*例如，假设要使业务机会记录满足规则条件，业务机会可能性必须大于 50%。如果创建一个可能性为 75% 的业务机会，则工作流规则运行。如果编辑该业务机会，将可能性更改为 25%或80%，则此次编辑不会导致规则运行。如果随后编辑该业务机会，将可能性从 25% 更改为 75%，则此次编辑导致规则运行。最后一次编辑时规则运行的原因是，记录从不满足规则条件更改为满足规则条件。*

* 为工作流规则输入描述。

### 向工作流规则添加即时操作

* 输入您的规则条件：输入评估结果为“真”或“假”值的公式。当公式返回“真”值时，会触发该工作流规则执行后续设置的操作。
* 向工作流规则添加即时操作，并点击保存。

### 向工作流规则添加依赖于时间的操作

* 在**依赖于时间的工作流操作**分组中向工作流规则添加依赖于时间的操作。
  * 输入您的过滤条件
    * 在特定时间执行依赖于时间的操作，例如记录结束日期前 10 天。该指定时间过后，工作流规则重新评估记录，以确保仍然符合过滤条件。如果记录符合过滤条件，则工作流规则会执行这些操作。
  * 添加时间触发器
    * 指定与记录相关的某日期（例如创建或修改记录的日期）之前或之后的天数或小时数。如果到达该时间时工作流规则仍有效，则时间触发器将引发工作流操作。
    * 在您创建的时间触发器部分，选择一个选项来创建操作或选择现有操作。



## 工作流规则示例

想要寻找方法让工作流规则帮助简化业务？观看这些示例。


### 自动启用新用户

* **对象：** 用户
* **描述：** 确保每个新用户为启用状态，以便用户可登录到Steedos。
* **评估条件：** 当记录进行以下操作时验证规则：新建时。
* **规则条件：** 公式：`active <> TRUE`
* **即时操作：** 字段更新：将启用设置为“真 (True)”。
  * *要更新的对象：用户*
  * *要更新的字段：active*
  * *新字段值类型：特定值*
  * *指定新字段值：勾选勾选框*


### 设置默认业务机会名称

一些公司的业务机会命名习惯是“客户名: 业务机会名称”。要在贵组织中自动确定每个业务机会的默认名称，请创建下列工作流规则。

* **对象：** 业务机会
* **描述：** 强制业务机会命名约定。
* **评估条件：** 当记录进行以下操作时验证规则：新建时，或编辑数据导致条件成立
* **规则条件：** 公式：`NOT(CONTAINS( Name, Account.Name ))`
* **即时操作：** 字段更新：将业务机会名称设置为指定公式值。
  * *要更新的对象：业务机会*
  * *要更新的字段：Name*
  * *新字段值类型：使用公式设置新值*
  * *公式：*`Account.Name & ": " & Name`


### 为个案设置目标解决日期

本示例会根据关联客户上的字段值设置个案解决日期。将会把客户对象上的“支持级别”字段设置为自定义选项列表字段，其中包含 3 个值：基础、标准和高级。此外，个案对象上的“目标解决日期”字段也是自定义日期字段。

使用下列三个工作流规则示例，以根据相关客户的支持级别设置个案的目标解决日期。

**a.设置基本支持的解决日期**

* **对象：** 个案
* **描述：** 为享受基本支持的客户设置个案目标解决日期：从现在起 30 日内。
* **评估条件：** 当记录进行以下操作时验证规则：新建时。
* **规则条件**：公式：`Account.Support_Level__c = "Basic"`
* **即时操作**：字段更新：设置目标解决日期为指定公式值。
  * *要更新的对象：个案*
  * *要更新的字段：Closed_Date__c*
  * *新字段值类型：使用公式设置新值*
  * *公式：*`Today() + 30`

**b.设置标准支持的解决日期**

* **对象：** 个案
* **描述：** 为享受标准支持的客户设置个案目标解决日期：从现在起 14 日内。
* **评估条件：** 当记录进行以下操作时验证规则：新建时。
* **规则条件：** 公式：`Account.Support_Level__c = "Standard"`
* **即时操作：** 字段更新：设置目标解决日期为指定公式值。
  * *要更新的对象：个案*
  * *要更新的字段：Closed_Date__c*
  * *新字段值类型：使用公式设置新值*
  * *公式：*`Today() + 14`

**c.设置高级支持的解决日期**

* **对象：** 个案
* **描述：** 为享受高级支持的客户设置个案目标解决日期：从现在起 5 日内。
* **评估条件：** 当记录进行以下操作时验证规则：新建时。
* **规则条件：** 公式：`Account.Support_Level__c = "Premium"`
* **即时操作：** 字段更新：设置目标解决日期为指定公式值。
  * *要更新的对象：个案*
  * *要更新的字段：Closed_Date__c*
  * *新字段值类型：使用公式设置新值*
  * *公式：*`Today() + 5`


### 候选人接受作业时更新应用程序记录

此工作流规则会在候选人接受任务时关闭应用程序记录。在主表/子表关系中的对象之间支持跨对象字段更新到主记录。

* **对象：** 候选人
* **描述：** 当自定义“候选人”对象的候选人状态字段更改为“已接受”时，为自定义“应用程序”对象将应用程序状态字段更改为“已关闭”。
* **评估条件：** 当记录进行以下操作时验证规则：新建时，或编辑数据导致条件成立
* **规则条件：** 公式：`Status = "Accepted"`
* **即时操作：** 字段更新：在父“应用程序”记录上更改应用程序状态字段为“已关闭”。
  * *要更新的对象：应用程序*
  * *要更新的字段：Status*
  * *新字段值类型：特定值*
  * *指定新字段值：选择框中选择“已关闭”选项*


### 覆盖默认业务机会结束日期

* **对象：** 业务机会
* **描述：** 将默认结束日期从该季度结束改写为业务机会创建后的 6 个月。
* **评估条件：** 当记录进行以下操作时验证规则：新建时
* **规则条件**：公式：`Closed = false`
* **即时操作**：字段更新：使用指定公式将业务机会关闭日期设置为创建日期之后六个月。
  * *要更新的对象：业务机会*
  * *要更新的字段：Close_Date*
  * *新字段值类型：使用公式设置新值*
  * *公式：*`DATE( YEAR(TODAY()) , (MONTH(TODAY()) + 6), DAY(TODAY()))`

### 在合同到期前跟进

* **对象：** 合同
* **描述：** 在合同结束日期前 20 日通过电子邮件为展期管理员发送提醒。
* **评估条件：** 当记录进行以下操作时验证规则：被创建，以及被编辑以便满足后续标准的任何时候
* **规则条件**：无
* **过滤条件**：公式：`[ ['Status', '=', 'Activated'] ]`
* **即时操作**：无
* **依赖于时间的操作**：合同前 20 天：结束日期——工作流通知：通过工作流通知为展期管理员发送提醒，以确认客户是否愿意延期。

### 合同收款预警

* **对象：** 合同收款计划
* **描述：** 依据收款计划，提前10天发送系统预警，并同时推送给财务系统。
* **评估条件：** 当记录进行以下操作时验证规则：被创建，以及被编辑以便满足后续标准的任何时候
* **规则条件**：无
* **过滤条件**：公式：`[ ['Status', '=', 'Activated'] ]`
* **即时操作**：无
* **依赖于时间的操作**：合同收款计划前 10 天：计划收款日期——工作流通知：通过工作流通知为展期管理员发送提醒，以确认客户是否按期付款；发送出站消息将收款提醒推送给财务系统。 
